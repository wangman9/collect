<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/ui-btn.css">
        <link rel="stylesheet" href="css/ui-input.css">
        <link rel="stylesheet" href="css/ui-img.css">
        <link rel="stylesheet" href="css/ui-list.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/ui-res.css">
        <link rel="stylesheet" href="css/common.css">
        <link rel="stylesheet" href="css/yhn.css">
        <script src="js/zy_control.js">
        </script>
        <script src="js/zy_click.js">
        </script>
        <script src="js/zy_json.js">
        </script>
        <script src="js/common.js">
        </script>
        <script src="js/des.js">
        </script>
    </head>
    <body class="um-vp  reslgbg ub-img7 " id="body" ontouchstart>
        <div id="page_0" class="up ub ub-ver " tabindex="0">
            <!--header结束--><!--content开始-->
            <div id="content" class="ub-f1 tx-l t-bla">
                <div class="uinn-a1 ub ub-ver">
                    <a href="product/index.html">click me!!!</a>
                    <!--块容器开始-->
                    <div class="ub ub-ver t-bla ">
                        <div class="ub ub-ac ub-pc">
                            <div class="logo umar-b tx-c">
                                <img src="css/images/logo.png" class="ub-fh" />
                            </div>
                        </div>
                    </div>
                    <div class="uinn  umar-t1">
                        <ul class="uc-a11 c-gra-s ub ub-ac lis">
                            <li class="lis-icon ub-img reslgaccount">
                            </li>
                            <li class="ub ub-f1">
                                <div class="ub-f1 uinput uinn4">
                                    <input placeholder="用户名" type="text" class="uc-a1 t-323232" id="username" value="" />
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="uinn ">
                        <ul class="uc-a11 c-gra-s ub ub-ac lis">
                            <li class="lis-icon ub-img reslgpwd">
                            </li>
                            <li class="ub ub-f1">
                                <div class="ub-f1 uinput uinn4">
                                    <input placeholder="密　码" type="password" class="uc-a1 t-323232" id="password" value="" />
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="uinn ">
                        <ul class="uc-a11 c-gra-s ub ub-ac lis">
                            <li class=" wh100">
                                <!--下拉列表开始-->
                                <div class="ub uc-a1 sel uinn4">
                                    <div id="selZD" class="ub-f1 ut-s uinn ulev-1 tx-l t-323232 ulev2">
                                        SHA PAX DOM 1
                                    </div>
                                    <div class="umw2 ub ub-pc uc-r1 ub-ac">
                                        <div class="umw1 umh1 arrow-down">
                                        </div>
                                    </div>
                                    <select id="selItem" name="sel0" selectedindex="0" id="sel2" onchange="zy_selectmenu(this.id)">
                                        <option id="TESTSITE">TESTSITE</option>
                                        <option id="SHAWB">TESTSITE2</option>
                                        <option id="PVGCGOLOAD">PVGCGOLOAD</option>
                                        <option id="PVGDEPT12">PVGDEPT12</option>
                                        <option id="SHAWB">PVGPAXTRANS</option>
                                        <option id="PVGRAMPT1">PVGRAMPT1</option>
                                        <option id="PVGRAMPT2">PVGRAMPT2</option>
                                        <option id="PVGT1LOAD">PVGT1LOAD</option>
                                        <option id="PVGT1LUG">PVGT1LUG</option>
                                        <option id="PVGT1PAX">PVGT1PAX</option>
                                        <option id="PVGT2LOAD">PVGT2LOAD</option>
                                        <option id="PVGT2LUG">PVGT2LUG</option>
                                        <option id="PVGT2PAX">PVGT2PAX</option>
                                        <option id="PVGWB">PVGWB</option>
                                        <option id="SHALOAD">SHALOAD</option>
                                        <option id="SHAPAXCONTROL">SHAPAXCONTROL</option>
                                        <option id="SHAPAXDOM1">SHAPAXDOM1</option>
                                        <option id="SHAPAXDOM2">SHAPAXDOM2</option>
                                        <option id="SHAPAXINTER">SHAPAXINTER</option>
                                        <option id="SHAPAXTRANS">SHAPAXTRANS</option>
                                        <option id="SHAPAXVEHICLE">SHAPAXVEHICLE</option>
                                        <option id="SHAPAXVIP">SHAPAXVIP</option>
                                        <option id="SHARAMP">SHARAMP</option>
                                        <option id="SHAT1LUG">SHAT1LUG</option>
                                        <option id="SHAT2LUG">SHAT2LUG</option>
                                        <option id="SHAWB">SHAWB</option>
                                        <option id="SHAWB">PVGHCC</option>
                                        <option id="SHAWB">SHAACC</option>
                                    </select>
                                </div>
                                <!--下拉列表结束-->
                            </li>
                        </ul>
                    </div>
                    <div class="uinn umar-t1">
                        <div class=" tx-c uinn5 c-red-m2 uc-a11 t-wh " ontouchstart="zy_touch('c-c50808')" onclick="showLoginContent('false')">
                            登录
                        </div>
                    </div>
                    <div class="uinn">
                        <div class=" tx-c uinn5 c-red-m2 uc-a11 t-wh " ontouchstart="zy_touch('c-c50808')" onclick="closeWidget()">
                            退出
                        </div>
                    </div>
                </div>
            </div>
            <!--content结束--><!--footer开始-->
            <div id="footer" class="uf">
                <!--全部块容器开始-->
                <div class="ub ub-ver ">
                    <div id="timePageDiv" class="uhide ">
                        <div class="c-gra c-m1 uc-a1 us-i uba b-gra " style="margin: 0 1em 0em 1em;">
                            <div style="padding: 1em 1em;">
                                震动时间设置：<span id="SliderSingle"></span>秒
                            </div>
                            <div data-role="fieldcontain" style="text-align: center; padding: 1em 1em 2em 1em;">
                                <!--块容器开始-->
                                <div class="ub t-bla" style="">
                                    <div class="ub-f1 uinnL" style="text-align: left;">
                                        0秒
                                    </div>
                                    <div class="ub-f1 uinnR" style="text-align: right;">
                                        60秒
                                    </div>
                                </div>
                                <!--块容器结束--><input type="range" name="slider" id="slider" value="20" min="0" max="60" onchange="getSliderVal()" style="width: 100%;"/>
                            </div>
                            <div class="tx-c umar-b ">
                                <!--setTimeOK star-->
                                <div class="btn uinn2 uinl c-red c-m1 uc-a1 t-wh ulev0" onclick="setTimeOk()">
                                    完 成
                                </div>
                                <!--setTimeOK end-->
                            </div>
                        </div>
                        <div class="c-gra umh_08 umw_08 rotate45 ubl ubb b-gra" style="margin: -.7em 0em 0em 2em;">
                        </div>
                    </div>
                    <div class=" uc-b1 ">
                        <!--下边的快容器-->
                        <div class="ub">
                            <div class="ub-f1 tx-l umar-l">
                                <div id="timerDiv" class="reszd ub-img" style="height: 3em; width: 3em;" onclick="setUpTime()">
                                </div>
                            </div>
                            <div class="uc-r1 t-gra umar-t3 umar-r">
                                版本号：<span id="versiontxt"></span>
                            </div>
                        </div>
                        <!--下边的块容器结束-->
                    </div>
                </div>
                <!--全部块容器结束-->
            </div>
            <!--footer结束-->
        </div>
        <div id="diyLoadDiv" class="uhide">
        </div>
    </body>
    <script>
    	/*
         * 界面功能描述
         * 1.登录(1.1强制登录；1.2显示资源界面)
         * 2.退出(退出应用、关闭APP中有定时器的界面)
         * 3.震动时间设置
         */
        zy_init();
		var newVersion ="",ZDText = '';
        window.uexOnload = function(type){
			//-----------------------------清除APP中旧有信息----------
			closeAllPage();
            setStorage("LoginResources", '');//情况资源
			setStorage("serviceAddress",'');//清空站点
			
			//-----------------------------初始加载 下拉框；帐号、密码；版本号；震动时间；前端日志创建----------
            initPage();//下拉框
//            createFile();
            $$('username').value = isDefine(getStorage('account')) == false ? "" : getStorage('account');
            $$('password').value = isDefine(getStorage('password')) == false ? "" : getStorage('password');
			
            //显示版本号
            uexWidgetOne.cbGetCurrentWidgetInfo = function(opId, dataType, data){
            
                var jsonStr = JSON.parse(data);
                $$("versiontxt").innerHTML = jsonStr.version;
				newVersion =jsonStr.version;
            }
            uexWidgetOne.getCurrentWidgetInfo();
            
            //设置震动时间[首次运用本APP 震动20，其余按客户自己的设置]
            if (isDefine(getStorage("vibrationTime")) == false) {
                setStorage("vibrationTime", 20000);
                $$("SliderSingle").innerHTML = "20";
                $$("slider").value = "20";
            }
            else {
            
                var sliderHistoryVal = getStorage("vibrationTime").substring(0, 2);
                $$("SliderSingle").innerHTML = sliderHistoryVal;
                $$("slider").value = sliderHistoryVal;
            }
			
			//前端日志
//			createFile();
			uexFileMgr.cbCreateFile = function writeTxtCallBack(opId, datatype, data){
                if (datatype == 2 && data == 0) {
                    fileIsCreate = true;
                }
                else {
                    loadingStart('日志文件创建失败！', 1500);
                }
            }
			
			//-----------------------------返回键设置、Confirm回调----------
            //设置Android返回键操作
            uexWindow.onKeyPressed = function(keyCode){
                if (keyCode == 0) 
                    closeWidget();
            }
            uexWindow.setReportKey(0, 1);
			
			//1.confirmType=appExit;[case 11的时候]；2.客户选择强制登录
            uexWindow.cbConfirm = function ConfirmSuccess(opId, dataType, data){
	            if (data == 0)//继续
	            {
					 if (getStorage("confirmType") == "appExit") {
					 	uexWidget.finishWidget('');
						setStorage("confirmType","");
						return;
					 }
	                showLoginContent('true');
	            }
	        }
        }
        
		//初始化下拉框
        function initPage(){
        
            if (isDefine(getStorage("selectedItem")) == false) {
                ZDText = $$("selItem").options[$$("selItem").selectedIndex].text;
            }
            else {
                $$("selItem").selectedIndex = getStorage("selectedItem");
                ZDText = $$("selItem").options[getStorage("selectedItem")].text;
            }
            $$("selZD").innerHTML = ZDText;
        }
         //-------------------------------------登录 1.登录总方法；2.强制登录；3.普通登录  BEGIN------------------------
        //isLogin false:第一次登录；true:强制登陆
        function showLoginContent(isLogin){
            
            var account = $$('username').value;
            var password = $$('password').value;
            ZDText = $$("selItem").options[$$("selItem").selectedIndex].text;
            setStorage('selectedItem', $$("selItem").selectedIndex);
            if (!account || !password) {
            
                uexWindow.alert("提示消息", "请输入用户名和密码", "确定");
                return;
            }
            setStorage('account', account);
            setStorage('password', password); 
            var data1 = base64.encode("{type:'01',condition:{username:'" + account + "',password:'" + password + "',forceOtherSessionLogoff:" + isLogin + ",serviceAddress:'" + ZDText + "'}}");
            var loginFun = isLogin == 'false' ? IsAlreadyLogged : Login;
            
            loadingStart("加载中...", 0);
            $.getJSON(loginUrl, loginFun, "json",function(err){
				 getJSONError(err);
			}, "POST", data1);
        }
        
        //判断是否已登录(强制登录)
        function IsAlreadyLogged(json){
            //        alert("IsAlreadyLogged----->"+ JSON.stringify(json));
            var loginStatus = json.array;
            
            switch (json.status) {
                case 1:
                    loadingStart(loginInterfaceError, 1500);
					contentTxt = loginInterfaceError;
                    break;
                case 2:
                    loadingStart(interfaceError2, 1500);
					contentTxt = interfaceError2;
                    break;
                case 3:
                    loadingStart(interfaceError3, 1500);
					contentTxt = interfaceError3;
                    break;
                case 4:
                    loadingEnd();
					contentTxt = interfaceError4;
                    uexWindow.confirm('', interfaceError4, "是;否".split(";"));
                    break;
                case 5:
                    loadingStart(interfaceError5, 1500);
					contentTxt = interfaceError5;
                    break;
                case 7:
                    loadingStart(interfaceError7, 1500);
					contentTxt = interfaceError7;
                    break;
				case 11:
				
					contentTxt ="case 11:" + json.desc;
					setStorage("confirmType","appExit");
                	uexWindow.confirm("提示消息",json.desc,"确定");
					loadingEnd();
                	break;
                default:
                    Login(json);
            }
//			writeTxt("强制登录接口IsAlreadyLogged() type01 返回内容：" + JSON.stringify(json) + "---->" + contentTxt);
        }
        
        //显示第二登录界面
        function Login(json){
            //                     alert("Login----->"+ JSON.stringify(json));
            switch (json.status) {
                case 0:
                    loadingEnd();
                    //增加消息推送功能
//                    uexWidget.setPushInfo('11210956', getStorage('account'));
                    
            		setStorage("LoginResources", '');//清空资源
                    setStorage("LoginResources", JSON.stringify(json));
                    setStorage("sessionID", json.array.sessionID);
					setStorage("serviceAddress",ZDText);
                    loadingStart('登录成功！', 1500);
                    uexWindow.open("login_content", 0, "login_content.html", 2, "", "", 0);
					contentTxt="登录成功";
                    break;
                case 1:
                    loadingStart(loginInterfaceError, 1500);
					contentTxt=loginInterfaceError;
                    break;
                case 2:
                    loadingStart(interfaceError2, 1500);
					contentTxt = interfaceError2;
                    break;
                case 3:
                    loadingStart(interfaceError3, 1500);
					contentTxt=interfaceError3;
                    break;
                case 5:
                    loadingStart(interfaceError5, 1500);
					contentTxt=interfaceError5;
                    break;
                case 7:
                    loadingStart("后台返回-->" + interfaceError7, 1500);
					contentTxt="后台返回：" + interfaceError7;
                    break;
				case 11:
				
					loadingEnd();
					setStorage("confirmType","appExit");
                	uexWindow.confirm("提示消息",json.desc,"确定");
					contentTxt=json.desc;
                	break;
                default:
                    loadingStart(loginInterfaceError, 1500);
					contentTxt="DEFAULT***" + loginInterfaceError;
                    break;
            }
//            writeTxt("登录接口Login() type01 返回内容：" + JSON.stringify(json) + "---->" + contentTxt);
        }
       //-----------------------------退出 1.退出App 2.关闭App界面------------------------ 
        //退出       
        function closeWidget(){
            uexWidget.finishWidget('');
//            writeTxt("登录界面 退出按钮");
        }
        
        //关闭程序中所有界面(在资源重复或意外关闭的时候 确保定时器关掉)
        function closeAllPage(){
        
            uexWindow.evaluateScript("login_content", "0", "closeLoginContent()");
            uexWindow.evaluateScript("index", "0", "closeSelf()");
        }
        
		 //-------------------------------------------------震动时间设置------------------------ 
        //设置任务震动时间
        function setUpTime(){
            $$("timerDiv").className = "reszd2 ub-img"; //闹钟图片
            $$("timePageDiv").className = " "; //显示设置界面
        }
        
        //时间设置完毕
        function setTimeOk(){
            var zdTime = $$("SliderSingle").innerHTML; //设置的时间
            setStorage("vibrationTime", zdTime * 1000);
            //            alert(zdTime * 1000);
            $$("timePageDiv").className = "uhide"; //隐藏设置界面
            $$("timerDiv").className = "reszd ub-img"; //闹钟变图片
        }
        
        //change时间 监听slider值的变化
        function getSliderVal(){
            $$("SliderSingle").innerHTML = $$("slider").value;
        }
    </script>
</html>
